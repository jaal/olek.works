---
import * as marked from 'marked';

const postImportResult = import.meta.globEager('../notes/**/*.md');
const posts = Object.values(postImportResult);

// Filter out posts with future dates (for scheduled publishing)
const now = new Date();
const publishedPosts = posts.filter((post) => {
  const postDate = new Date(post.frontmatter.added.replace(/-/g, '/'));
  return postDate <= now;
});

const postsWithContent = await Promise.all(
  publishedPosts.map(async (post) => {
    let rawContent = await post.rawContent();
    let html = marked.parse(rawContent);

    return {
      ...post,
      htmlContent: html,
    };
  })
);

postsWithContent.sort((a, b) => {
  return new Date(b.frontmatter.added) - new Date(a.frontmatter.added);
});

const postsToDisplay = postsWithContent.slice(0, 20);
const feedUrl = 'https://olekwrites.com/rss';
const siteUrl = 'https://olekwrites.com/';
const title = "My name is Olek. I write what matters to me.";
const description = "Hi üëãüèº I'm Olek. Here I write about what matters to me. I'm a co-founder of 2 kids üë®‚Äçüë©, married happily üíç, and üçï lover.";
---

<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{title} - RSS Feed</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    html {
      scroll-behavior: smooth;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
      color: #d6d6e1;
      background: #121220;
      min-height: 100vh;
      padding: 20px;
    }
    @media(max-width:640px) {
      body {
        padding: 10px;
      }
    }
    .container {
      max-width: 1024px;
      margin: 0 auto;
    }
    .header {
      text-align: center;
      padding: 40px 20px;
      border-bottom: 1px solid #2e2e3e;
    }
    @media(max-width:640px) {
      .header {
        padding: 30px 15px;
      }
    }
    .header h1 {
      font-size: 32px;
      font-weight: 700;
      margin: 0 0 12px;
      background: linear-gradient(135deg, #818cf8 0%, #e879f9 100%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    @media(max-width:640px) {
      .header h1 {
        font-size: 24px;
        flex-direction: column;
        gap: 8px;
      }
    }
    .rss-icon {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #818cf8 0%, #e879f9 100%);
      -webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z'/%3E%3C/svg%3E") no-repeat center;
      mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z'/%3E%3C/svg%3E") no-repeat center;
      -webkit-mask-size: 100%;
      mask-size: 100%;
    }
    .header p {
      color: #a8a8b8;
      font-size: 16px;
      margin: 0 0 24px;
      line-height: 1.7;
    }
    .header .visit-btn {
      display: inline-block;
      color: #fff;
      background: linear-gradient(135deg, #4f46e5 0%, #9333ea 100%);
      text-decoration: none;
      padding: 12px 28px;
      border-radius: 8px;
      font-weight: 600;
      transition: all .3s ease;
      border: none;
    }
    .header .visit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(79, 70, 229, .3);
    }
    .info {
      background: #1a1a2e;
      border: 1px solid #2e2e3e;
      border-radius: 12px;
      padding: 24px;
      margin: 30px 0;
    }
    .info h2 {
      font-size: 18px;
      color: #fff;
      margin: 0 0 12px;
      font-weight: 600;
    }
    .info p {
      color: #a8a8b8;
      margin: 0 0 12px;
      line-height: 1.7;
      font-size: 15px;
    }
    .info a {
      color: #818cf8;
      font-weight: 500;
      text-decoration: none;
      transition: color .2s;
    }
    .info a:hover {
      color: #a78bfa;
      text-decoration: underline;
    }
    .subscribe-btns {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 16px;
    }
    @media(max-width:640px) {
      .subscribe-btns {
        flex-direction: column;
      }
    }
    .subscribe-btn {
      display: inline-block;
      padding: 10px 20px;
      background: #2e2e3e;
      border: 1px solid #3e3e4e;
      border-radius: 8px;
      color: #d6d6e1;
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      transition: all .2s;
      text-align: center;
    }
    .subscribe-btn:hover {
      background: #4f46e5;
      border-color: #4f46e5;
      color: #fff;
    }
    .feed-url {
      background: #0d0d14;
      border: 1px solid #2e2e3e;
      border-radius: 6px;
      padding: 12px 16px;
      margin-top: 12px;
      font-family: Consolas, Monaco, monospace;
      font-size: 13px;
      color: #818cf8;
      word-break: break-all;
    }
    .content {
      padding: 30px 20px;
    }
    @media(max-width:640px) {
      .content {
        padding: 20px 0;
      }
    }
    .content > h2 {
      font-size: 24px;
      color: #fff;
      margin: 0 0 24px;
      font-weight: 600;
      padding-bottom: 12px;
      border-bottom: 2px solid #4f46e5;
    }
    .posts {
      display: flex;
      flex-direction: column;
      gap: 32px;
    }
    .post {
      padding: 0;
    }
    .post-header {
      cursor: pointer;
      padding: 20px;
      background: #1a1a2e;
      border: 1px solid #2e2e3e;
      border-radius: 12px;
      transition: all .2s;
    }
    .post-header:hover {
      border-color: #4f46e5;
      background: #1f1f31;
    }
    .post h3 {
      font-size: 20px;
      font-weight: 600;
      margin: 0 0 8px;
      color: #fff;
      line-height: 1.4;
    }
    .post h3 a {
      color: #fff;
      text-decoration: none;
    }
    .post-meta {
      color: #6e6e81;
      font-size: 14px;
      margin-bottom: 12px;
    }
    .post-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }
    .tag {
      display: inline-block;
      padding: 4px 12px;
      background: #2e2e3e;
      color: #a8a8b8;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
      border: 1px solid #3e3e4e;
    }
    .post-content {
      margin-top: 16px;
      padding: 20px;
      background: #0d0d14;
      border: 1px solid #2e2e3e;
      border-radius: 12px;
      display: none;
    }
    .post-content.show {
      display: block;
    }
    .post-desc {
      color: #a8a8b8;
      line-height: 1.8;
      font-size: 15px;
    }
    .post-desc p {
      margin: 0 0 16px;
    }
    .post-desc h1, .post-desc h2, .post-desc h3, .post-desc h4 {
      color: #fff;
      margin: 24px 0 12px;
      font-weight: 600;
      line-height: 1.3;
    }
    .post-desc h1 {
      font-size: 28px;
    }
    .post-desc h2 {
      font-size: 24px;
    }
    .post-desc h3 {
      font-size: 20px;
    }
    .post-desc a {
      color: #818cf8;
      text-decoration: none;
      transition: color .2s;
    }
    .post-desc a:hover {
      color: #a78bfa;
      text-decoration: underline;
    }
    .post-desc img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: 20px 0;
      border: 1px solid #2e2e3e;
    }
    .post-desc ul, .post-desc ol {
      margin: 16px 0;
      padding-left: 28px;
      color: #a8a8b8;
    }
    .post-desc li {
      margin-bottom: 8px;
    }
    .post-desc code {
      background: #2e2e3e;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: .9em;
      font-family: Consolas, Monaco, monospace;
      color: #e879f9;
      border: 1px solid #3e3e4e;
    }
    .post-desc pre {
      background: #0d0d14;
      border: 1px solid #2e2e3e;
      color: #d6d6e1;
      padding: 16px;
      border-radius: 8px;
      overflow-x: auto;
      margin: 16px 0;
    }
    .post-desc pre code {
      background: transparent;
      border: none;
      padding: 0;
    }
    .post-desc blockquote {
      border-left: 3px solid #4f46e5;
      padding-left: 20px;
      margin: 16px 0;
      color: #a8a8b8;
      font-style: italic;
    }
    .post-desc hr {
      border: none;
      border-top: 1px solid #2e2e3e;
      margin: 24px 0;
    }
    .post-desc strong {
      color: #fff;
      font-weight: 600;
    }
    .read-more {
      display: inline-block;
      margin-top: 16px;
      padding: 10px 20px;
      background: #4f46e5;
      color: #fff;
      text-decoration: none;
      border-radius: 6px;
      font-weight: 500;
      transition: all .2s;
    }
    .read-more:hover {
      background: #6366f1;
      transform: translateY(-1px);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>
        <span class="rss-icon"></span>
        <span>{title}</span>
      </h1>
      <p>{description}</p>
      <a class="visit-btn" href={siteUrl} target="_blank" rel="noopener">Visit Website ‚Üí</a>
    </div>

    <div class="info">
      <h2>üì° Subscribe to this RSS Feed</h2>
      <p>This is an <strong>RSS feed</strong>. Copy the URL below or click a reader button to subscribe and get new posts automatically.</p>
      <p>New to RSS? <a href="https://aboutfeeds.com/" target="_blank">Learn more about RSS feeds</a></p>
      <div class="feed-url">{feedUrl}</div>
      <div class="subscribe-btns">
        <a class="subscribe-btn" href={`https://feedly.com/i/subscription/feed/${feedUrl}`} target="_blank">Feedly</a>
        <a class="subscribe-btn" href={`https://www.inoreader.com/feed/${feedUrl}`} target="_blank">Inoreader</a>
        <a class="subscribe-btn" href={`https://www.newsblur.com/?url=${feedUrl}`} target="_blank">NewsBlur</a>
        <a class="subscribe-btn" href={`https://feedbin.com/?subscribe=${feedUrl}`} target="_blank">Feedbin</a>
      </div>
    </div>

    <div class="content">
      <h2>Recent Posts</h2>
      <div class="posts">
        {postsToDisplay.map((post, index) => (
          <article class="post">
            <div class="post-header" onclick={`togglePost(${index})`}>
              <h3>{post.frontmatter.title}</h3>
              <div class="post-meta">
                Published: {new Date(post.frontmatter.added).toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric'
                })}
              </div>
              {post.frontmatter.tags && post.frontmatter.tags.length > 0 && (
                <div class="post-tags">
                  {post.frontmatter.tags.map((tag) => (
                    <span class="tag">{tag}</span>
                  ))}
                </div>
              )}
            </div>
            <div class="post-content" id={`content-${index}`}>
              <div class="post-desc" set:html={post.htmlContent}></div>
              <a class="read-more" href={`https://olekwrites.com/${post.frontmatter.slug}`} target="_blank" rel="noopener">Read Full Post ‚Üí</a>
            </div>
          </article>
        ))}
      </div>
    </div>
  </div>

  <script>
    function togglePost(id) {
      const content = document.getElementById('content-' + id);
      if (content) {
        content.classList.toggle('show');
      }
    }
  </script>
</body>
</html>
